# 혀엉... 콰인

[난해한 혀엉... 언어 v0.4.5](https://gist.github.com/xnuk/d9f883ede568d97caa158255e4b4d069) 기준으로 작성되었습니다.

## 일러두기
### `NaN`이 포함된 스택
`NaN`은 해당 값을 직접 다루고 있는 경우가 아니면 스택의 끝으로 간주합니다. `NaN`이 포함된 스택인지 빈 스택인지 확인할 방법이 없기 때문입니다. 그럼에도 `NaN`이 포함된 스택을 다루고자 한다면 스택의 길이를 별도로 저장해야 합니다.

### 버리기 스택
혀엉...에서는 값을 뽑아서 버릴 수 있는 별도의 스택이 있으면 수월한 코드 작성이 가능합니다. 프로그램 실행 시 현재 스택이 3번이므로 편의상 4번 스택을 버리기 스택으로 이용합니다. 또한 버리기 스택은 임시 변수를 저장하는 데에도 이용할 수 있습니다.

## 코드 템플릿
버리기 스택을 이용하는 코드는 *로 표시해 두었습니다.

### 프로그램 정상 종료
```
흑.항
```
- 현재 스택에서 값을 하나 뽑아 출력하고 종료합니다.
- 마지막 글자를 `핫`, `흣`, `흡`, `흑`으로 대체가 가능합니다.

### 스택 이동*
```
흑.....항....
```
- 5번 스택으로 이동합니다.

### 스택 값 전부 출력*
```
형혀어엉..♥하앙....항.흐윽...형하앗...혀어엉..하앙...혀어엉..?♥!
```
```
형혀어엉..♥하앙....  # 반복문의 시작
항.  # 출력
흐윽...형하앗...혀어엉..하앙...혀어엉..?♥!  # 스택의 다음 값이 NaN이면 반복문을 벗어남
```
- 3번 스택이 비어 있지 않을 경우 스택에 저장된 값을 전부 출력합니다.
- 3번 스택이 비어 있을 경우 `너무 커엇...`을 출력합니다.
- 출력하는 부분에 추가적인 명령을 실행할 수 있습니다.
- 코드에 있는 `혀어엉..`은 `(6, ♥)`에 명령어를 등록하기 위함이며  다른 `형` 종류의 값으로 대체될 수 있습니다.

### 주어진 값을 주어진 양만큼 스택에 넣기*
```
형혀어엉..♥하앙....흑.....항....흑.....흑...항....형.흣....하앙...흡....흡....흐윽...형하앗...혀어엉..하앙...혀어엉..?♥!하앙....흑.....하앙....
```
```
형혀어엉..♥하앙....  # 반복문의 시작
흑.....항....흑.....  # 5번 스택의 값을 복사
흑...항....형.흣....하앙...  # 3번 스택으로 이동 후 1 감소
흡....흡....  # 3번 스택의 값이 0이면 NaN으로 바꿈
흐윽...형하앗...혀어엉..하앙...혀어엉..?♥!  # NaN이면 반복문을 벗어남
하앙....흑.....하앙....  # 한 개 버림
```
- 5번 스택의 값을 3번 스택의 값만큼 복사해서 5번 스택에 넣습니다.

## 콰인 만들기
### 데이터 저장
- 코드를 나타내는 데이터는 3번 스택에 4개 원소 단위로 저장됩니다.
- 메모리가 스택이므로 데이터를 읽고 복사하는 과정에서 한 번 순서가 바뀌고, 출력하는 과정에서 한 번 더 순서가 바뀌므로 순서대로 저장합니다.
- 네 개의 숫자는 각각 16진수 유니코드의 `1000`, `100`, `10`, `1`의 자리를 의미합니다.

### 데이터 읽기
```
형형♥하앙....흑...항.....항......흐윽...형하앗...형♥!
```
- 데이터를 읽어들이면서 5번과 6번 스택에 각각 저장합니다.
- 5번 스택은 데이터를 저장하는 데 이용했던 코드를 출력하기 위해 사용합니다.
- 6번 스택은 데이터 자체를 출력하기 위해 사용합니다.

### 데이터 출력
#### 데이터를 저장하는 데 이용한 코드 출력
저장된 데이터는 `0`과 `15` 사이의 값을 가지므로 `형` 뒤에 마침표를 읽어들인 숫자만큼 찍어 줍니다. `간지`가 안 나지만 숫자별로 다르게 구현하려면 `시간`과 `노오오력`이 많이 필요합니다.

#### 저장된 데이터를 출력
앞의 네 숫자를 읽어들이면서 문자의 유니코드 코드를 계산하고, 바로 출력합니다.

## 구현
### 프로토타입
[hyeong-quine-prototype.hyeong](hyeong-quine-prototype.hyeong)

### 완성!!
[흑.흑 뀨이디꺼 너무 커엇...](hyeong-quine.hyeong)
- 첫째 줄 : 누군가가 `형`을 [애타게 찾고 있는](hyeong-quine-howto.md#데이터-저장) 단계입니다.
- 둘째 줄 : 드디어 `형`을 [찾아내고](hyeong-quine-howto.md#데이터-읽기), [하으읏...읏응](hyeong-quine-howto.md#데이터-출력) 하는 단계입니다.
- 셋째 줄 : 너무 크다고 흐느끼며 마치는 단계입니다.

### 실행
[Rust로 작성한 혀엉... 구현체](https://github.com/VBChunguk/hyeong-rs)와 [혀엉씨(C 구현체)](https://github.com/ikasty/hyeongc)에서 실행한 결과 정상 작동함을 확인하였습니다.

### 기타
원래는 3번 스택에 5개 단위의 데이터를 넣어 마지막 값이 해당 문자가 반복되는 횟수를 나타내게 하려고 하였습니다. 그 방법이 코드의 양을 줄여줄지도 모르지만 구현하기 귀찮으므로 다른 분들을 위해 남겨 둡니다.
